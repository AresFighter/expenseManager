# Сценарии использования системы учета личных расходов

## 1. Добавление новой траты

**Цель:** Позволить пользователю добавить новую запись о расходе с автоматическим определением категории и проверкой на дубликаты.

**Актёры:** Финансовый менеджер

**Триггер:** Пользователь решает зафиксировать новый расход

**Предусловия:**
- Приложение открыто
- Выбран источник данных (Память, JSON, PostgreSQL)
- Все поля формы доступны для редактирования

**Основной поток:**
1. Пользователь вводит сумму и описание
2. Опционально выбирает категорию (можно оставить пустым)
3. Устанавливает дату и время через DatePicker и TimeSpinner
4. Нажимает "Добавить"
5. Система валидирует сумму (должна быть числом)
6. Если категория не указана - определяется автоматически по ключевым словам
7. Определяется статус траты по сумме:
   - <1000 - Мелкий
   - 1000-10000 - Обычный
   - >10000 - Крупный
8. Проверка на дубликаты (одинаковые сумма+описание в течение часа)
9. Если дубликатов нет - запись сохраняется в хранилище
10. Таблица обновляется, форма очищается

**Альтернативные потоки:**
- A1: Некорректная сумма
  - Система показывает ошибку "Некорректная сумма"
  - Пользователь исправляет и повторяет
- A2: Найден дубликат
  - Система показывает предупреждение
  - Пользователь отменяет или изменяет данные

**Постусловия:**
- Новая трата добавлена в базу
- При ошибках форма не очищается

## 2. Редактирование существующей траты

**Цель:** Изменить данные существующей траты

**Актёры:** Финансовый менеджер, Администратор

**Триггер:** Пользователь выбирает запись для редактирования

**Предусловия:**
- Приложение открыто
- В таблице есть хотя бы одна запись
- Запись выбрана

**Основной поток:**
1. Пользователь выбирает запись в таблице
2. Форма автоматически заполняется данными выбранной траты
3. Пользователь редактирует поля
4. Нажимает "Изменить"
5. Система проверяет корректность данных
6. Если данные верны - сохраняет изменения
7. Таблица и статус обновляются

**Альтернативные потоки:**
- A1: Ошибка в данных
  - Система показывает "Некорректная сумма"
  - Пользователь исправляет данные

**Постусловия:**
- Данные траты обновлены
- Интерфейс готов к новым действиям

## 3. Удаление траты

**Цель:** Удалить ошибочную или ненужную запись

**Актёры:** Финансовый менеджер, Администратор

**Триггер:** Пользователь выбирает запись для удаления

**Предусловия:**
- Приложение открыто
- Запись выбрана в таблице

**Основной поток:**
1. Пользователь выбирает запись
2. Нажимает "Удалить"
3. Система удаляет запись по ID
4. Таблица обновляется

**Альтернативные потоки:**
- A1: Запись не выбрана
  - Система показывает "Выберите расход для удаления"

**Постусловия:**
- Запись удалена
- Интерфейс обновлен

## 4. Поиск по тратам

**Цель:** Фильтрация записей по ключевым словам

**Актёры:** Финансовый менеджер, Аналитик, Администратор

**Триггер:** Ввод текста в поле поиска

**Предусловия:**
- Приложение открыто
- В таблице есть данные

**Основной поток:**
1. Пользователь вводит текст поиска
2. Система в реальном времени ищет совпадения в:
   - Описании
   - Категории
   - Сумме
3. Отображаются только подходящие записи
4. При очистке поля - показываются все записи

**Постусловия:**
- Таблица показывает отфильтрованные данные

## 5. Сортировка трат

**Цель:** Упорядочить записи по дате или сумме

**Актёры:** Аналитик

**Триггер:** Выбор типа сортировки

**Предусловия:**
- Приложение запущено
- Есть записи в таблице
- Доступен выпадающий список сортировки

**Основной поток:**
1. Пользователь открывает список сортировки
2. Выбирает вариант:
   - По дате (новые/старые)
   - По сумме (возр./убыв.)
3. Система применяет сортировку
4. Таблица обновляется

**Постусловия:**
- Данные отсортированы по выбранному критерию

## 6. Прогнозирование бюджета

**Цель:** Построить прогноз расходов на следующий месяц

**Актёры:** Аналитик

**Триггер:** Нажатие кнопки "Прогноз бюджета"

**Предусловия:**
- Приложение запущено
- Есть данные за последние 3 месяца
- Доступны график и кнопка

**Основной поток:**
1. Пользователь нажимает кнопку
2. Система рассчитывает:
   - Средние расходы за 3 месяца
   - Поправочные коэффициенты (сезонность)
3. Отображает график с:
   - Средними значениями
   - Прогнозом на следующий месяц

**Постусловия:**
- Показан график прогноза
- Интерфейс доступен

## 7. Автоматическая категоризация

**Цель:** Автоматически определить категорию траты

**Актёры:** Финансовый менеджер

**Триггер:** Добавление траты без указания категории

**Предусловия:**
- Приложение запущено
- Загружены категории и ключевые слова

**Основной поток:**
1. Пользователь вводит описание и сумму
2. Оставляет категорию пустой
3. Нажимает "Добавить"
4. Система:
   - Ищет ключевые слова в описании
   - Для сумм >5000₽ ставит "Крупные расходы"
5. Запись сохраняется с определенной категорией

**Альтернативные потоки:**
- A1: Ключевые слова не найдены
  - Устанавливается "Прочее"

**Постусловия:**
- Запись добавлена с автоматической категорией

## 8. Смена источника данных

**Цель:** Переключение между хранилищами данных

**Актёры:** Все пользователи

**Триггер:** Выбор источника из списка

**Предусловия:**
- Все DAO доступны
- Интерфейс активен

**Основной поток:**
1. Пользователь выбирает источник:
   - Память
   - JSON
   - PostgreSQL
2. Нажимает "Выбрать"
3. Система инициализирует соответствующий DAO
4. Таблица обновляется

**Альтернативные потоки:**
- A1: Ошибка подключения к PostgreSQL
  - Показывается "Не удалось подключиться к БД"

**Постусловия:**
- Работа с выбранным хранилищем
- Данные обновлены

## 9. Проверка на дубликаты

**Цель:** Предотвратить дублирование трат

**Актёры:** Финансовый менеджер, Администратор

**Триггер:** Попытка добавления новой траты

**Предусловия:**
- Есть существующие записи
- Проверка по сумме, описанию и времени (1 час)

**Основной поток:**
1. Пользователь вводит данные траты
2. Система проверяет дубликаты:
   - Та же сумма + описание
   - В течение последнего часа
3. Если найден - показывает предупреждение
4. Если нет - добавляет запись

**Постусловия:**
- Дубликаты блокируются
- Пользователь получает уведомление
